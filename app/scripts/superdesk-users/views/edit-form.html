<div class="user-profile-edit">
<form name="userForm" ng-submit="userForm.$valid && save()">

  <div>
    <div class="action-buttons-main clearfix" ng-class="{show:dirty}">
        <button type="submit" class="btn btn-info pull-right" ng-disabled="userForm.$invalid || !dirty" translate>Save</button>
        <button type="button" class="btn pull-right" ng-click="cancel()" ng-disabled="!dirty" translate>Cancel</button>
    </div>

    <div class="profile-pic">
        <figure>
            <img sd-user-picture data-src="user.Avatar.href" alt="{{ user.FullName }}">
        </figure>

        <a sd-beta href="" ng-show="user.Id" class="change-photo" ng-click="editPicture()" translate>Change Photo</a>
    </div>


    <div class="profile-info user-profile-edit">
        <div class="header-info">
            <h2>{{ user.FullName }}</h2>
            <h5>{{ user.UserName }}</h5>
        </div>
        <div class="error-holder">
          <p class="alert alert-error" ng-show="error" translate>Please fix the issues below.</p>
        </div>
        <div class="details-info" ng-class="{shifted : error}">
            <div class="details-section">
                <div class="details-section-header" translate>General</div>

                <div sd-info-item ng-show="user.Id">
                  <label for="display-name" translate>full name</label>
                  <input type="text" name="fullName" id="display-name" ng-model="user.FullName" readonly>
                </div>

                <div sd-info-item>
                  <label for="first-name" translate>first name</label>
                  <input type="text" name="firstName" id="first-name" ng-model="user.FirstName" required>
                  <div ng-show="userForm.firstName.$error.required" sd-valid-error translate>please provide a first name.</div>
                </div>

                <div sd-info-item>
                  <label for="last-name" translate>last name</label>
                  <input type="text" name="lastName" id="last-name" ng-model="user.LastName" required>
                  <div ng-show="userForm.lastName.$error.required" sd-valid-error translate>please provide a last name.</div>
                </div>

                <div sd-info-item>
                  <label for="username" translate>username</label>
                  <input type="text" name="userName" id="username"
                    ng-model="user.UserName"
                    ng-readonly="user.Id"
                    ng-pattern="usernamePattern"
                    sd-user-unique data-unique-field="userName" data-exclude="user"
                    required>
                  <div ng-show="userForm.userName.$error.required" sd-valid-error translate>please provide a username.</div>
                  <div ng-show="userForm.userName.$error.unique || error.UserName.conflict" sd-valid-error translate>sorry, this username is already taken.</div>
                  <div ng-show="userForm.userName.$error.pattern" sd-valid-error translate>please use only letters (a-z), numbers (0-9), dashes (&mdash;), underscores (_), apostrophes (') and periods (.).</div>
                </div>

                <div sd-info-item class="password" ng-if="!user.Id">
                  <label for="password" translate>password</label>
                  <input type="password" name="password" ng-minlength="5" id="password" ng-model="user.Password" required>
                  <div ng-show="userForm.password.$error.required" sd-valid-error translate>please provide a password.</div>
                  <div ng-show="userForm.password.$error.minlength" sd-valid-error translate>password must have at least 5 characters.</div>
                </div>

                <div sd-info-item class="password" ng-if="!user.Id">
                  <label for="passwordConfirm" translate>confirm</label>
                  <input type="password" name="passwordConfirm" ng-minlength="5" id="passwordConfirm" sd-password-confirm ng-model="confirm.password" data-password="user.Password" required>
                  <div ng-show="userForm.passwordConfirm.$error.confirm" sd-valid-error translate>passwords must be same.</div>
                </div>

                <div sd-info-item class="password" ng-if="user.Id" id="password-change-trigger">
                  <label translate>password</label>
                  <i class="change-btn" ng-click="show.password = !show.password" ng-show="!show.password">change password</i>
                </div>

                <div sd-info-item>
                  <label for="email" translate>email</label>
                  <input type="email" name="email" id="email"
                    ng-model="user.EMail"
                    sd-user-unique data-unique-field="email" data-exclude="user"
                    required>
                  <div ng-show="userForm.email.$error.required" sd-valid-error translate>please provide an email address.</div>
                  <div ng-show="userForm.email.$error.email || error.EMail.format" sd-valid-error translate>please provide a valid email address.</div>
                  <div ng-show="userForm.email.$error.unique || error.EMail.unique" sd-valid-error translate>sorry, a user with this email already exists.</div>
                </div>

                <div sd-info-item>
                  <label for="phone" translate>phone number</label>
                  <input type="text" name="phone" id="phone" ng-model="user.PhoneNumber" ng-pattern="phonePattern">
                  <div ng-show="userForm.phone.$error.pattern || error.PhoneNumber.format" sd-valid-error translate>please provide number in international format</div>
                </div>

                <div sd-info-item ng-show="user.Id">
                  <label for="created" translate>member since</label>
                  <span class="info-value" sd-reldate ng-model="user.CreatedOn"></span>
                </div>

                <div sd-info-item ng-show="">
                  <label for="user_role" translate>user role</label>
                  <div sd-select class="info-value" ng-model="user.role" options="role._id as role.name for role in rolesList"></div>
                </div>
            </div>
        </div>
    </div>
  </div>
</form>

<div sd-change-password class="password-popup" ng-if="show.password && user.Id" ng-class="{shifted : error}">
    <div class="title">Change password</div>
    <div class="content-holder">
      <div class="password-change-holder" >
          <form name="passwordForm">

            <label translate>current</label>
            <input name="old" type="password" ng-model="oldPwd" required>
            <p sd-valid-error ng-show="oldPasswordInvalid">sorry, but this is not the original password.</p>

            <label translate>new</label>
            <input name="new" type="password" ng-model="newPwd" required ng-minlength="5">
            <p sd-valid-error ng-show="passwordForm.new.$error.minlength">please provide password at least 5 characters long.</p>

            <label translate>confirm</label>
            <input name="confirm" type="password" ng-model="_confirm" required
              sd-password-confirm ng-model="_confirm" data-password="newPwd">
            <p sd-valid-error ng-show="passwordForm.confirm.$error.confirm">confirm doesn't match new password yet.</p>

            <div class="action-buttons">
              <button type="reset" class="btn btn-small" ng-click="show.password = false" translate>Cancel</button>
              <button type="submit" class="btn btn-info btn-small"
                ng-click="passwordForm.$valid && changePassword(oldPwd, newPwd)"
                ng-disabled="passwordForm.$invalid"
                translate>Save password</button>
            </div>
          </form>
      </div>
    </div>
</div>
